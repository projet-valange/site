<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="../../common/img/icon.png" rel="shortcut icon">
    <title>Valange</title>
    <!-- styles -->
    <link rel="stylesheet" href="../../lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../lib/bootstrap/css/bootstrap-grid.min.css">
    <link rel="stylesheet" href="../../common/style.css">
</head>

<body>

<div class="container">

    <div class="media">
        <a class="pull-left" href="./index.html">
            <img class="media-object" src="../../common/img/logo.png" style="width:50%;"/>
        </a>
    </div>
    <hr>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-9 col-md-9">
                <h1><a style="color:#e88f47; ">E</a>dition d'une contribution</h1>
                <div class="row">
                    <div class="input-group btn-lg btn-success pull-right">
                        <!--
                        <div class="input-group-prepend">
                            <span class="input-group-text">Ouvrir un extrait (métadonnées)</span>
                        </div>
                        -->
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="inputGroupFile01" onchange="system.openLocalFile(event)">
                            <label class="custom-file-label" for="inputGroupFile01">Ouvrir un extrait (métadonnées)</label>
                        </div>
                    </div>
                    <br/>
                    <div>
                        <button type="button" onclick="saveData()" class="btn btn-lg btn-primary pull-right" 
                            id="btnSaveExtract">Sauvegarder l'extrait (métadonnées)</button>
                    </div>
                </div>
                <hr/>
                <h2 id="nameentry"></h2>
                <hr/>
                <legend>Informations sur le/la contributeur·trice</legend>
                <include src="extractedit.html"></include>
                <!-- add edition of entry, media, actkey, themekey, and duration -->
                <div class="edit-group>
                    <label class="control-label" for="language"><strong>Langue :</strong></label>
                    <input type="text" class="form-control" id="language" name="language" maxlength="120">
                </div>
                <div class="edit-group>
                    <label class="control-label" for="entry"><strong>Entry :</strong></label>
                    <input type="text" class="form-control" id="entry" name="entry" maxlength="120">
                </div>
                <div class="edit-group>
                    <label class="control-label" for="media"><strong>Media :</strong></label>
                    <input type="text" class="form-control" id="media" name="media" maxlength="120">
                </div>
                <div class="edit-group>
                    <label class="control-label" for="actkey"><strong>Clés normalisées à utiliser pour Activités :</strong></label>
                    <input type="text" class="form-control" id="actkey" name="actkey" maxlength="120">
                </div>
                <div class="edit-group>
                    <label class="control-label" for="themekey"><strong>Clés normalisées à utiliser pour Thème :</strong></label>
                    <input type="text" class="form-control" id="themekey" name="themekey" maxlength="120">
                </div>
                <div class="edit-group>
                    <label class="control-label" for="duration"><strong>Durée :</strong></label>
                    <input type="text" class="form-control" id="duration" name="duration" maxlength="120">
                </div>
            </div>
        </div>
    </div>

    <br/>
    <hr>

    <include src="footer.html"></include>

</div> <!-- /container -->

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="../../lib/jquery/jquery.min.js"></script>
<script src="../../lib/bootstrap/js/bootstrap.min.js"></script>
<script src="../../common/filesaver.js"></script>
<script src="../../common/system.js"></script>
<script>

    $("#secondpart").hide();
    $("#infodroit").hide();
    var lastfilename = "extract.xml";
    /**
     * function for opening an external file and filling the data
     */
    system.process = function(filename, filecontent) {
        lastfilename = filename;
        var meta = parsemetadata.parseMetadata(filecontent, filename);
        console.log(filecontent);
        console.log(meta);

        $('#nameentry').text(meta.entry);
        $('input[name="name"]').val(meta.name);
        $('input[name="surname"]').val(meta.surname)
        $('input[name="institution"]').val(meta.institution);
        $('input[name="email"]').val(meta.email);
        $('input[name="namechi"]').val(meta.child);
        $('input[name="age"]').val(meta.age);
        $('input[name="localisation"]').val(meta.localisation);
        $('input[name="project"]').val(meta.project);
        $('input[name="title"]').val(meta.title);
        $('textarea[name="description"]').val(meta.description);
        $('textarea[name="transcription"]').val(meta.transcription);
        $('textarea[name="quote"]').val(meta.quote);
        $('input[name="act"]').val(meta.act);
        $('input[name="theme"]').val(meta.theme);
        $('input[name="keywords"]').val(meta.keywords);
        $('input[name="media"]').val(meta.media);
        $('input[name="extmedia"]').val(meta.extmedia);
        $('input[name="entry"]').val(meta.entry);
        $('input[name="actkey"]').val(meta.actkey);
        $('input[name="themekey"]').val(meta.themekey);
        $('input[name="duration"]').val(meta.duration);

        if (meta.lang.indexOf("fra") >= 0 || meta.lang === "fr") {
            $("input[name='fra']").prop('checked', true);
        }
        if (meta.lang.indexOf("eng") >= 0 || meta.lang === "en") {
            $("input[name='eng']").prop('checked', true);
        }
        if (meta.lang.indexOf("ita") >= 0 || meta.lang === "it") {
            $("input[name='ita']").prop('checked', true);
        }
        if (meta.lang.indexOf("bra") >= 0 || meta.lang === "br") {
            $("input[name='bra']").prop('checked', true);
        }
        if (meta.lang.indexOf("oth") >= 0 || meta.lang === "") {
            $("input[name='oth']").prop('checked', true);
        }
        if (meta.lang === "it (fr)") {
            $("input[name='ita']").prop('checked', true);
            $("input[name='fra']").prop('checked', true);
        }
        $('input[name="language"]').val(meta.lang);

        if (meta.agree === "agreement signed") {
            $("input[name='agree']").prop('checked', true);
        } else {
            $("input[name='agree']").prop('checked', false);
        }
        if (meta.disc === "monologue") {
            $("input[name='disc'][value='monologue']").prop('checked', true);
        } else if (meta.disc === "monologue") {
            $("input[name='disc'][value='interaction']").prop('checked', true);
        } else {
            $("input[name='disc'][value='unknown']").prop('checked', true);
        }
        if (meta.gender === "girl") {
            $("input[name='gender'][value='girl']").prop('checked', true);
        } else if (meta.gender === "boy") {
            $("input[name='gender'][value='boy']").prop('checked', true);
        } else {
            $("input[name='gender'][value='unknown']").prop('checked', true);
        }
        /*
        console.log("xml", getXmlData());
        console.log("xml", getXmlDataUser());
        console.log("entry", getEntryName());
        */
    }

    function saveData() {
        var data = getXmlDataValidator();
        console.log("valid:", data);
        system.saveFileLocal("xml", lastfilename, data);
    }

</script>

</body>

</html>